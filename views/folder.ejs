<!DOCTYPE html>
<html lang="en"></html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Folder: <%= currentFolder.name %></title>
  </head>
  <body>
    <% if (success_msg) { %>
      <div style="color: green; border: 1px solid green; padding: 10px; margin-bottom: 15px;">
        <%= success_msg %>
      </div>
    <% } %>

    <% if (error_msg) { %>
      <div style="color: red; border: 1px solid red; padding: 10px; margin-bottom: 15px;">
        <%= error_msg %>
      </div>
    <% } %>
    <h1>Viewing: <%= currentFolder.name %></h1>
    <form action="/folders/<%= currentFolder.id %>/update" method="POST" style="display: inline-block; margin-left: 20px;">
      <input type="text" name="newName" placeholder="New name" value="<%= currentFolder.name %>" required>
      <button type="submit">Rename</button>
    </form>
    <a href="/dashboard">Back to Dashboard (Root)</a>
    <hr>


    <hr />

    <h2>Create New Subfolder</h2>
    <form action="/folders" method="POST">
      <input
        type="text"
        name="folderName"
        placeholder="Subfolder name"
        required
      />

      <input type="hidden" name="parentId" value="<%= currentFolder.id %>" />

      <button type="submit">Create</button>
    </form>

    <hr />

    <h2>Subfolders</h2>
    <ul>
      <% if (folders.length > 0) { %> <% folders.forEach(folder => { %>
      <li>
        <a href="/folders/<%= folder.id %>"> <%= folder.name %> </a>
      </li>
      <% }) %> <% } else { %>
      <li>No subfolders.</li>
      <% } %>
    </ul>

    <hr>
    <h2>Upload File to this Folder</h2>
    <form action="/files/upload" method="POST" enctype="multipart/form-data">
      <input type="file" name="file" required>
      <input type="hidden" name="parentId" value="<%= currentFolder.id %>">
      <button type="submit">Upload File</button>
    </form>

    <h2>Files in this folder</h2>
    <ul>
      <% if (files.length > 0) { %>
      <% files.forEach(file => { %>
        <li>
        <a href="/files/<%= file.id %>">
          <%= file.name %>
        </a>
        </li>
      <% }) %>
      <% } else { %>
      <li>No files in this folder.</li>
      <% } %>
    </ul>

    <hr>
    <h3>Share Folder</h3>
    <form action="/folders/<%= currentFolder.id %>/share" method="POST" style="background: #f0f0f0; padding: 15px; border-radius: 5px;">
      <label for="duration">Link Duration:</label>
      <select name="duration" id="duration">
      <option value="1">1 Day</option>
      <option value="7">7 Days</option>
      <option value="30">30 Days</option>
      </select>
      <button type="submit">Generate Public Link</button>
    </form>

    <hr>
    <h2 style="color: red;">Danger Zone</h2>
    <form
      action="/folders/<%= currentFolder.id %>/delete"
      method="POST"
      onsubmit="return confirm('ARE YOU SURE?\nThis will permanently delete this folder and ALL subfolders and files it contains.');"
    >
      <button type="submit" style="background-color: red; color: white; border: none; padding: 10px 20px; cursor: pointer;">
      Delete this Folder
      </button>
    </form>
  </body>
</html>
